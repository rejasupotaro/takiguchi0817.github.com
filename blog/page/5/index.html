
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Just posted a blog</title>
    <meta name="author" content="rejasupotaro">
    
	<meta name="description" content="Published on: Oct 19th, 2012 Tags: Android おもにWindowsの方からつらいという声聞こえた スマートフォン向けのウェブサイトのデバッグ、console.log()を見る方法いくつかある。 Eclipseのlogcatを見る &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Just posted a blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-36257112-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Just posted a blog
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/takiguchi0817" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/rejasupotaro" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/10/19/browsercat/">
		
			Androidでconsole.log()を見る</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-10-19T19:07:00+09:00" pubdate data-updated="true">Oct 19<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
    </div>
		<h2>おもにWindowsの方からつらいという声聞こえた</h2>

<p>スマートフォン向けのウェブサイトのデバッグ、console.log()を見る方法いくつかある。</p>

<ul>
<li><p>Eclipseのlogcatを見る<br/>
Android開発者ならまだしも、JavaScript書いてるのにEclipse立ち上げたくない。</p></li>
<li><p>標準ブラウザでabout:debug<br/>
対応してないバージョンもある。それにPCにエラーログ出た方が嬉しい。<br/>
<img src="http://dl.dropbox.com/u/54255753/blog/201210/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202012-10-19%2019.29.40.png" alt="スクリーンショット" /></p></li>
<li><p>adb logcat<br/>
Linuxとかなら adb logcat | grep browser 出来るけど、windowsだとgrep出来なくて悲しい。</p></li>
<li><p>busyboxを入れて端末側でgrepする<br/>
ビルドが面倒とか、すべての検証端末に入れるのが面倒とか。</p></li>
</ul>


<h2>BrowserCatを作ったニャン</h2>

<p><a href="https://github.com/takiguchi0817/BrowserCat">BrowserCat</a><br/>
<img src="http://dl.dropbox.com/u/54255753/blog/201210/%E3%82%B9%E3%82%AF%E3%83%AA%E3%83%BC%E3%83%B3%E3%82%B7%E3%83%A7%E3%83%83%E3%83%88%202012-10-19%2020.22.30.png" alt="スクリーンショット" /><br/>
windowsでもadbが入ってれば動きます。<br/>
まだログが見れるくらいしか機能ないです。</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/10/09/appli-comparison/">
		
			アプリのデータはどこに保存されるの</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-10-09T22:02:00+09:00" pubdate data-updated="true">Oct 9<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
    </div>
		<h2>内部ストレージ /data/data/package.name</h2>

<ul>
<li>cache</li>
<li>databases</li>
<li>files</li>
<li>lib</li>
<li>shared_prefs</li>
</ul>


<h3>cache</h3>

<pre><code>getCacheDir()
</code></pre>

<ul>
<li>com.android.renderscript.cache<br/>
勝手に作られる。RenderScript使ったことないので良く知らない。</li>
<li>webviewCacheChromium<br/>
WebViewのキャッシュ</li>
</ul>


<h3>files</h3>

<pre><code>openFileOutput()
</code></pre>

<p>アプリによって使ったり。</p>

<h3>databases</h3>

<pre><code>getWritableDatabase()
</code></pre>

<ul>
<li>webview.db<br/>
メタデータとか認証情報とかパスワードとか。</li>
<li>webviewCookiesChromium.db<br/>
メタデータとかクッキーとか。</li>
</ul>


<h3>lib</h3>

<p>使ってたら入る。</p>

<h3>shared_prefs</h3>

<pre><code>getSharedPreferences()
</code></pre>

<p>databasesに入れるほどでもないけど、filesに置きたくないデータを入れてる。<br/>
最後にアプリを開いた時間とか、データをリフレッシュした時間とか、タブレットかとか。</p>

<h2>外部ストレージ /mnt/sdcard/Android/data/package.name</h2>

<pre><code>getExternalFilesDir()
</code></pre>

<p>見えても良いデータを置いてる。<br/>
画像とか動画とかのキャッシュにされてることが多い気がする。</p>

<h2>その他</h2>

<p>それ以外にもパス指定すればファイル作れる。<br/>
各社、セキュアな情報はプリファレンスに入れてるか、暗号化してそこらに置いてる。<br/>
プリファレンスの中は平文で保存されていることが多いけど、実際に端末を盗んでroot化しないの見れないので、良いと思う。<br/>
アカウントマネージャを使っているアプリはSDカードに移動できないようにしている。再マウント時にアカウントを復帰させるのあんまりやらないのかな。</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/10/06/android-encryption/">
		
			Androidの画像の暗号化</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-10-06T17:05:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/android/'>Android</a>, <a class='category' href='/blog/categories/encryption/'>Encryption</a>


</div>
    </div>
		<h2>SDカードに保存する画像を暗号化したい</h2>

<h3>Androidの暗号化手法</h3>

<p>Androidで使用出来る暗号化手法一覧：Security.getAlgorithms(&#8220;Cipher&#8221;)</p>

<pre><code>PBEWITHSHAAND192BITAES-CBC-BC
PBEWITHSHAAND40BITRC4
PBEWITHSHAAND128BITRC2-CBC
PBEWITHSHA256AND256BITAES-CBC-BC
PBEWITHSHAAND128BITAES-CBC-BC
PBEWITHSHAAND40BITRC2-CBC
PBEWITHSHA1ANDDES
AESWRAP
DES
AES
DESEDEWRAP
PBEWITHSHAAND256BITAES-CBC-BC
PBEWITHSHA256AND192BITAES-CBC-BC
PBEWITHMD5AND128BITAES-CBC-OPENSSL
PBEWITHMD5AND256BITAES-CBC-OPENSSL
BLOWFISH
PBEWITHSHAAND2-KEYTRIPLEDES-CBC
PBEWITHSHA1ANDRC2
PBEWITHMD5AND192BITAES-CBC-OPENSSL
ARC4
PBEWITHMD5ANDDES
RSA
PBEWITHSHA256AND128BITAES-CBC-BC
PBEWITHSHAAND3-KEYTRIPLEDES-CBC
DESEDE
PBEWITHSHAANDTWOFISH-CBC
PBEWITHSHAAND128BITRC4
PBEWITHMD5ANDRC2
</code></pre>

<p>色々あるが、今回はAESを検証した。</p>

<h3>コード</h3>

<p>定数</p>

<pre><code>private static final byte[] SALT = new byte[] {
    -47, 66, 32, -127, -102, -51, 79, -69, 57, 85, -91, -42, 74, -116 };
private static final byte[] INITAIL_VECTOR = {
    16, 74, 71, -80, 32, 101, -47, 72, 117, -14, 0, -29, 70, 65, -12, 74 };
private static final String CIPHER_ALGORITM = "AES/CBC/PKCS5Padding";
</code></pre>

<p>鍵の生成</p>

<pre><code>private static SecretKey generateKey()
        throws  NoSuchAlgorithmException, InvalidKeySpecException {  

    // ここでは"password"を与えているが実際にやってはいけない
    char[] password = "password".toCharArray();

    // ソルト、イテレーションカウント1024回、鍵の長さ256ビットを指定
    KeySpec keySpec = new PBEKeySpec(password, SALT, 1024, 256);  
    SecretKeyFactory factory = SecretKeyFactory.getInstance("PBEWITHSHAAND256BITAES-CBC-BC");  
    SecretKey secretKey = factory.generateSecret(keySpec);  

    return secretKey;  
}
</code></pre>

<p>暗号化</p>

<pre><code>public static byte[] encrypt(Bitmap bitmap)
        throws
        NoSuchAlgorithmException, InvalidKeySpecException, NameNotFoundException,
        InvalidKeyException, NoSuchPaddingException, InvalidAlgorithmParameterException,
        IllegalBlockSizeException, BadPaddingException {

    SecretKey secretKey = generateKey();

    // 暗号アルゴリズムにAESを指定
    Cipher cipher = Cipher.getInstance(CIPHER_ALGORITM);

    // 暗号化モードに設定し、キーを指定
    cipher.init(Cipher.ENCRYPT_MODE, secretKey, new IvParameterSpec(INITAIL_VECTOR));

    // 暗号化の実行
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    bitmap.compress(CompressFormat.JPEG, 100, bos);
    return cipher.doFinal(bos.toByteArray());
}
</code></pre>

<p>復号</p>

<pre><code>public static Bitmap decrypt(byte[] crypted)
        throws
        NoSuchAlgorithmException, InvalidKeySpecException, NoSuchPaddingException,
        InvalidKeyException, InvalidAlgorithmParameterException,
        IllegalBlockSizeException, BadPaddingException {

    SecretKey secretKey = generateKey();

    // 暗号アルゴリズムにAESを指定
    Cipher cipher = Cipher.getInstance(CIPHER_ALGORITM);

    // 暗号化モードに設定し、キーを指定
    cipher.init(Cipher.DECRYPT_MODE, secretKey, new IvParameterSpec(INITAIL_VECTOR));

    // 復号の実行
    byte[] decrypted = cipher.doFinal(crypted);
    BitmapFactory.Options options = new BitmapFactory.Options();
    return BitmapFactory.decodeByteArray(decrypted, 0, decrypted.length, options);
}
</code></pre>

<h3>検証</h3>

<p>500 * 500 の画像10枚の暗号化と復号にかかった時間を測定…しようと思って実行したらアプリが応答しなかった。</p>

<p>traceviewで画像1枚の処理時間を調べたら、全体で6800msec掛かっていた。encrypt(generateKey込み)が80%、decryptが20%で、generateKeyにかなりの時間がかかっていた。<br/>
なのでsecretKeyを外で生成して暗号化・復号に掛かる時間を計測してみたら2800msecになった。</p>

<h3>感想</h3>

<p>画像を暗号化するなら、ローカルに置くよりサーバに置いた方が速いし楽な気がする。<br/>
絶対に見られてはならない機密情報ってほどでもないが、あんまり見られたくないという画像は、<a href="http://www.kk.iij4u.or.jp/~kondo/bmp/">ヘッダ</a>をいじるのが良いのだろうか。</p>

<p>画像に関してはあれだが、アクセストークンくらいなら速いししばらくメモリに乗ってそうだし、良さそう。<br/>
注意する点として、SharedPreferenceにはStringしか保存できないので、暗号化と復号の処理の間にBase64化処理が必要になる。<br/>
しかもAndroidのBase64クラスが使えるのは2.2以降なので、そういうのをうまくやる必要がある。</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/10/06/google-play-on-emulator/">
		
			エミュレータにGoogle Playにあるapkを入れる</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-10-06T13:41:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/android/'>Android</a>


</div>
    </div>
		<p>方法は2つ。</p>

<ol>
<li>エミュレータにGoogle Playを入れる</li>
<li>PCでapkをダウンロードしてadbでエミュレータに移す</li>
</ol>


<p>1の方法は面倒な感じしたので2にすることにした。</p>

<h2>Google Playからapkを直接ダウンロードできるようにする</h2>

<p>Chrome拡張を入れることでブラウザ版のGoogle Playからapkをダウンロードできるようになる。</p>

<h3>AndroidのデバイスIDを調べる</h3>

<p>アプリを使うと簡単。
<a href="https://play.google.com/store/apps/details?id=com.redphx.deviceid">Device ID</a>
を起動してDevice IDをメモしておく。</p>

<h3>APK Downloaderを入れる</h3>

<p><a href="http://codekiem.com/2012/02/24/apk-downloader/">APK Downloader – Download APK files from Android Market to PC</a></p>

<p>詳しい手順：
<a href="http://www.teradas.net/archives/3894/">PlayストアからAndroidのapkを直接ダウンロードできる「APK Downloader」</a></p>

<p>apkをダウンロードしたら、以下のオプションでchromeを起動する。</p>

<pre><code>open -a Google\ Chrome --args --ignore-certificate-errors
</code></pre>

<p>「ツール」→「拡張機能」の画面にドラッグ・アンド・ドロップ。</p>

<h2>エミュレータにインストールする</h2>

<p>実際にapkをダウンロードしてエミュレータにインストールする。</p>

<h3>Google Playからapkをダウンロードする。</h3>

<p>Google Playに行ってインストールしたいアプリのインストールページに行く。<br/>
アドレスバーのところにAPK Downloaderのアイコンが出るので、クリックしてダウンロード。</p>

<h3>エミュレータにインストールする</h3>

<pre><code>$ emulator -avd device_name
$ adb install ~/Downloads/HelloGooglePlay.apk
</code></pre>

<p>/data/data/パッケージ名 にダウンロードされる。</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/blog/2012/10/06/hello-octopress/">
		
			Hello Octopress</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-10-06T13:09:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/octopress/'>Octopress</a>


</div>
    </div>
		<p>某ブログから移転しました。<br/>
ブラウザ立ち上げてサイトに行ってかっこいいUIをしながらプレビューを比較しながら調整してオシャンティなブログをポスするのって結構面倒くさい。<br/>
ターミナルで編集できてコマンドでデプロイ出来て、Octopress良いです。</p>

<p><a href="https://github.com/imathis/octopress/wiki">テーマ</a>も色々あるみたいだし、自分でスタイルシートとかいじって可愛くしたいですね。</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/4/" class="prev">Prev</a>
    
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2013

    rejasupotaro
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
