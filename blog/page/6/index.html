
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Just posted a blog</title>
  <meta name="author" content="rejasupotaro">

  
  <meta name="description" content="内部ストレージ /data/data/package.name cache
databases
files
lib
shared_prefs cache getCacheDir() com.android.renderscript.cache
勝手に作られる。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://takiguchi0817.github.com/blog/page/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Just posted a blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36257112-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Just posted a blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:takiguchi0817.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/09/appli-comparison/">アプリのデータはどこに保存されるの</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-09T22:02:00+09:00" pubdate data-updated="true">Oct 9<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>内部ストレージ /data/data/package.name</h2>

<ul>
<li>cache</li>
<li>databases</li>
<li>files</li>
<li>lib</li>
<li>shared_prefs</li>
</ul>


<h3>cache</h3>

<pre><code>getCacheDir()
</code></pre>

<ul>
<li>com.android.renderscript.cache<br/>
勝手に作られる。RenderScript使ったことないので良く知らない。</li>
<li>webviewCacheChromium<br/>
WebViewのキャッシュ</li>
</ul>


<h3>files</h3>

<pre><code>openFileOutput()
</code></pre>

<p>アプリによって使ったり。</p>

<h3>databases</h3>

<pre><code>getWritableDatabase()
</code></pre>

<ul>
<li>webview.db<br/>
メタデータとか認証情報とかパスワードとか。</li>
<li>webviewCookiesChromium.db<br/>
メタデータとかクッキーとか。</li>
</ul>


<h3>lib</h3>

<p>使ってたら入る。</p>

<h3>shared_prefs</h3>

<pre><code>getSharedPreferences()
</code></pre>

<p>databasesに入れるほどでもないけど、filesに置きたくないデータを入れてる。<br/>
最後にアプリを開いた時間とか、データをリフレッシュした時間とか、タブレットかとか。</p>

<h2>外部ストレージ /mnt/sdcard/Android/data/package.name</h2>

<pre><code>getExternalFilesDir()
</code></pre>

<p>見えても良いデータを置いてる。<br/>
画像とか動画とかのキャッシュにされてることが多い気がする。</p>

<h2>その他</h2>

<p>それ以外にもパス指定すればファイル作れる。<br/>
各社、セキュアな情報はプリファレンスに入れてるか、暗号化してそこらに置いてる。<br/>
プリファレンスの中は平文で保存されていることが多いけど、実際に端末を盗んでroot化しないの見れないので、良いと思う。<br/>
アカウントマネージャを使っているアプリはSDカードに移動できないようにしている。再マウント時にアカウントを復帰させるのあんまりやらないのかな。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/06/android-encryption/">Androidの画像の暗号化</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-06T17:05:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>SDカードに保存する画像を暗号化したい</h2>

<h3>Androidの暗号化手法</h3>

<p>Androidで使用出来る暗号化手法一覧：Security.getAlgorithms(&#8220;Cipher&#8221;)</p>

<pre><code>PBEWITHSHAAND192BITAES-CBC-BC
PBEWITHSHAAND40BITRC4
PBEWITHSHAAND128BITRC2-CBC
PBEWITHSHA256AND256BITAES-CBC-BC
PBEWITHSHAAND128BITAES-CBC-BC
PBEWITHSHAAND40BITRC2-CBC
PBEWITHSHA1ANDDES
AESWRAP
DES
AES
DESEDEWRAP
PBEWITHSHAAND256BITAES-CBC-BC
PBEWITHSHA256AND192BITAES-CBC-BC
PBEWITHMD5AND128BITAES-CBC-OPENSSL
PBEWITHMD5AND256BITAES-CBC-OPENSSL
BLOWFISH
PBEWITHSHAAND2-KEYTRIPLEDES-CBC
PBEWITHSHA1ANDRC2
PBEWITHMD5AND192BITAES-CBC-OPENSSL
ARC4
PBEWITHMD5ANDDES
RSA
PBEWITHSHA256AND128BITAES-CBC-BC
PBEWITHSHAAND3-KEYTRIPLEDES-CBC
DESEDE
PBEWITHSHAANDTWOFISH-CBC
PBEWITHSHAAND128BITRC4
PBEWITHMD5ANDRC2
</code></pre>

<p>色々あるが、今回はAESを検証した。</p>

<h3>コード</h3>

<p>定数</p>

<pre><code>private static final byte[] SALT = new byte[] {
    -47, 66, 32, -127, -102, -51, 79, -69, 57, 85, -91, -42, 74, -116 };
private static final byte[] INITAIL_VECTOR = {
    16, 74, 71, -80, 32, 101, -47, 72, 117, -14, 0, -29, 70, 65, -12, 74 };
private static final String CIPHER_ALGORITM = "AES/CBC/PKCS5Padding";
</code></pre>

<p>鍵の生成</p>

<pre><code>private static SecretKey generateKey()
        throws  NoSuchAlgorithmException, InvalidKeySpecException {  

    // ここでは"password"を与えているが実際にやってはいけない
    char[] password = "password".toCharArray();

    // ソルト、イテレーションカウント1024回、鍵の長さ256ビットを指定
    KeySpec keySpec = new PBEKeySpec(password, SALT, 1024, 256);  
    SecretKeyFactory factory = SecretKeyFactory.getInstance("PBEWITHSHAAND256BITAES-CBC-BC");  
    SecretKey secretKey = factory.generateSecret(keySpec);  

    return secretKey;  
}
</code></pre>

<p>暗号化</p>

<pre><code>public static byte[] encrypt(Bitmap bitmap)
        throws
        NoSuchAlgorithmException, InvalidKeySpecException, NameNotFoundException,
        InvalidKeyException, NoSuchPaddingException, InvalidAlgorithmParameterException,
        IllegalBlockSizeException, BadPaddingException {

    SecretKey secretKey = generateKey();

    // 暗号アルゴリズムにAESを指定
    Cipher cipher = Cipher.getInstance(CIPHER_ALGORITM);

    // 暗号化モードに設定し、キーを指定
    cipher.init(Cipher.ENCRYPT_MODE, secretKey, new IvParameterSpec(INITAIL_VECTOR));

    // 暗号化の実行
    ByteArrayOutputStream bos = new ByteArrayOutputStream();
    bitmap.compress(CompressFormat.JPEG, 100, bos);
    return cipher.doFinal(bos.toByteArray());
}
</code></pre>

<p>復号</p>

<pre><code>public static Bitmap decrypt(byte[] crypted)
        throws
        NoSuchAlgorithmException, InvalidKeySpecException, NoSuchPaddingException,
        InvalidKeyException, InvalidAlgorithmParameterException,
        IllegalBlockSizeException, BadPaddingException {

    SecretKey secretKey = generateKey();

    // 暗号アルゴリズムにAESを指定
    Cipher cipher = Cipher.getInstance(CIPHER_ALGORITM);

    // 暗号化モードに設定し、キーを指定
    cipher.init(Cipher.DECRYPT_MODE, secretKey, new IvParameterSpec(INITAIL_VECTOR));

    // 復号の実行
    byte[] decrypted = cipher.doFinal(crypted);
    BitmapFactory.Options options = new BitmapFactory.Options();
    return BitmapFactory.decodeByteArray(decrypted, 0, decrypted.length, options);
}
</code></pre>

<h3>検証</h3>

<p>500 * 500 の画像10枚の暗号化と復号にかかった時間を測定…しようと思って実行したらアプリが応答しなかった。</p>

<p>traceviewで画像1枚の処理時間を調べたら、全体で6800msec掛かっていた。encrypt(generateKey込み)が80%、decryptが20%で、generateKeyにかなりの時間がかかっていた。<br/>
なのでsecretKeyを外で生成して暗号化・復号に掛かる時間を計測してみたら2800msecになった。</p>

<h3>感想</h3>

<p>画像を暗号化するなら、ローカルに置くよりサーバに置いた方が速いし楽な気がする。<br/>
絶対に見られてはならない機密情報ってほどでもないが、あんまり見られたくないという画像は、<a href="http://www.kk.iij4u.or.jp/~kondo/bmp/">ヘッダ</a>をいじるのが良いのだろうか。</p>

<p>画像に関してはあれだが、アクセストークンくらいなら速いししばらくメモリに乗ってそうだし、良さそう。<br/>
注意する点として、SharedPreferenceにはStringしか保存できないので、暗号化と復号の処理の間にBase64化処理が必要になる。<br/>
しかもAndroidのBase64クラスが使えるのは2.2以降なので、そういうのをうまくやる必要がある。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/06/google-play-on-emulator/">エミュレータにGoogle Playにあるapkを入れる</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-06T13:41:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>方法は2つ。</p>

<ol>
<li>エミュレータにGoogle Playを入れる</li>
<li>PCでapkをダウンロードしてadbでエミュレータに移す</li>
</ol>


<p>1の方法は面倒な感じしたので2にすることにした。</p>

<h2>Google Playからapkを直接ダウンロードできるようにする</h2>

<p>Chrome拡張を入れることでブラウザ版のGoogle Playからapkをダウンロードできるようになる。</p>

<h3>AndroidのデバイスIDを調べる</h3>

<p>アプリを使うと簡単。
<a href="https://play.google.com/store/apps/details?id=com.redphx.deviceid">Device ID</a>
を起動してDevice IDをメモしておく。</p>

<h3>APK Downloaderを入れる</h3>

<p><a href="http://codekiem.com/2012/02/24/apk-downloader/">APK Downloader – Download APK files from Android Market to PC</a></p>

<p>詳しい手順：
<a href="http://www.teradas.net/archives/3894/">PlayストアからAndroidのapkを直接ダウンロードできる「APK Downloader」</a></p>

<p>apkをダウンロードしたら、以下のオプションでchromeを起動する。</p>

<pre><code>open -a Google\ Chrome --args --ignore-certificate-errors
</code></pre>

<p>「ツール」→「拡張機能」の画面にドラッグ・アンド・ドロップ。</p>

<h2>エミュレータにインストールする</h2>

<p>実際にapkをダウンロードしてエミュレータにインストールする。</p>

<h3>Google Playからapkをダウンロードする。</h3>

<p>Google Playに行ってインストールしたいアプリのインストールページに行く。<br/>
アドレスバーのところにAPK Downloaderのアイコンが出るので、クリックしてダウンロード。</p>

<h3>エミュレータにインストールする</h3>

<pre><code>$ emulator -avd device_name
$ adb install ~/Downloads/HelloGooglePlay.apk
</code></pre>

<p>/data/data/パッケージ名 にダウンロードされる。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/10/06/hello-octopress/">Hello Octopress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-06T13:09:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>某ブログから移転しました。<br/>
ブラウザ立ち上げてサイトに行ってかっこいいUIをしながらプレビューを比較しながら調整してオシャンティなブログをポスするのって結構面倒くさい。<br/>
ターミナルで編集できてコマンドでデプロイ出来て、Octopress良いです。</p>

<p><a href="https://github.com/imathis/octopress/wiki">テーマ</a>も色々あるみたいだし、自分でスタイルシートとかいじって可愛くしたいですね。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/22/the-problem-with-pingdom/">The Problem With Pingdom</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-22T19:13:00+09:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content">

<figure class='code'><figcaption><span>Time to be Awesome - awesome.rb </span></figcaption>
 <div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='rb'><span class='line'><span class="nb">puts</span> <span class="s2">&quot;Awesome!&quot;</span> <span class="k">unless</span> <span class="n">lame</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="http://www.pingdom.com%20Pingdom">The problem with pingdom.</a></p>

<p>My money&#8217;s in that office, right? If she start giving me some bullshit about it ain&#8217;t there, and we got to go someplace else and get it, I&#8217;m gonna shoot you in the head then and there. Then I&#8217;m gonna shoot that bitch in the kneecaps, find out where my goddamn money is. She gonna tell me too. Hey, look at me when I&#8217;m talking to you, motherfucker. You listen: we go in there, and that nigga Winston or anybody else is in there, you the first motherfucker to get shot. You understand?</p>

<blockquote><p>Blockquote is what goes
inside this block here
would you believe that
bullshit?</p></blockquote>

<p>Well, the way they make shows is, they make one show. That show&#8217;s called a pilot. Then they show that show to the people who make shows, and on the strength of that one show they decide if they&#8217;re going to make more shows. Some pilots get picked and become television programs. Some don&#8217;t, become nothing. She starred in one of the ones that became nothing.</p>

<p>The path of the righteous man is beset on all sides by the iniquities of the selfish and the tyranny of evil men. Blessed is he who, in the name of charity and good will, shepherds the weak through the valley of darkness, for he is truly his brother&#8217;s keeper and the finder of lost children. And I will strike down upon thee with great vengeance and furious anger those who would attempt to poison and destroy My brothers. And you will know My name is the Lord when I lay My vengeance upon thee.</p>

<p>Your bones don&#8217;t break, mine do. That&#8217;s clear. Your cells react to bacteria and viruses differently than mine. You don&#8217;t get sick, I do. That&#8217;s also clear. But for some reason, you and I react the exact same way to water. We swallow it too fast, we choke. We get some in our lungs, we drown. However unreal it may seem, we are connected, you and I. We&#8217;re on the same curve, just on opposite ends.</p>

<p>Do you see any Teletubbies in here? Do you see a slender plastic tag clipped to my shirt with my name printed on it? Do you see a little Asian child with a blank expression on his face sitting outside on a mechanical helicopter that shakes when you put quarters in it? No? Well, that&#8217;s what you see at a toy store. And you must think you&#8217;re in a toy store, because you&#8217;re here shopping for an infant named Jeb.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2012/07/22/intro/">Intro</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-07-22T08:23:00+09:00" pubdate data-updated="true">Jul 22<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Testing!</p>

<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Duis sollicitudin, massa eu vestibulum laoreet, nibh ante vulputate lorem, ac lobortis ante tellus eu mi. Duis sem nisi, luctus at feugiat eget, fringilla ut tellus. Nam a molestie justo. Sed pulvinar est vitae tellus semper tincidunt. Fusce euismod luctus lacus nec placerat. Mauris rutrum scelerisque nulla ut tempor. Nunc porttitor posuere mi, aliquet vehicula lorem feugiat in. Ut ut fermentum risus. Aliquam tincidunt ultricies ante sit amet bibendum. Cras nec sapien odio. Duis posuere congue sem, at congue massa faucibus at.</p>

<p>Integer ut sapien eget nisl auctor faucibus ut fermentum arcu. Nunc rutrum urna non risus congue et tristique felis eleifend. Maecenas blandit est eu mauris aliquam aliquet. Quisque porttitor enim eget risus blandit in mollis orci eleifend. Nam malesuada nulla sed lacus elementum placerat accumsan arcu rhoncus. Phasellus feugiat cursus turpis nec facilisis. Duis eget metus arcu, eget commodo velit. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Integer cursus vulputate enim, vel gravida velit faucibus et. Ut a urna vitae tellus cursus rhoncus. Maecenas at odio eget quam cursus elementum. Aliquam vitae eros quis tellus laoreet accumsan sed id lorem. Suspendisse et rutrum leo. Integer scelerisque vestibulum adipiscing. In posuere, libero ac accumsan suscipit, nulla ligula gravida erat, ut tempor odio erat nec sem. Quisque justo ipsum, adipiscing volutpat varius vitae, blandit eget nisi.</p>

<p>Nullam adipiscing neque ac lacus commodo vitae imperdiet dui sollicitudin. Ut ac nunc augue. Nam at sem ut quam commodo aliquet vitae vitae dui. Vivamus scelerisque felis eget dolor cursus feugiat. Phasellus at dui sed lectus scelerisque pretium. Etiam nec massa ut justo vestibulum fringilla ac vitae urna. Morbi tortor erat, tempus sed consectetur at, elementum nec eros. Vivamus mattis arcu a sapien semper non lacinia eros pretium.</p>

<p>Proin ut hendrerit arcu. Maecenas ullamcorper tristique magna vel mattis. Pellentesque habitant morbi tristique senectus et netus et malesuada fames ac turpis egestas. Nullam tincidunt euismod viverra. In sit amet neque turpis. Suspendisse ac sapien mi, id blandit purus. Ut tortor turpis, rutrum ac tempor at, accumsan sit amet erat. Etiam ultricies eleifend dolor, eget tempus justo tristique vitae. In hac habitasse platea dictumst. Aliquam eu enim neque.</p>

<p>Morbi massa lorem, viverra non dictum at, malesuada vel nibh. Nam fermentum lobortis varius. Sed a nulla lacus, quis posuere risus. Nunc id urna libero, quis rutrum mi. In gravida felis urna. Praesent nec dolor ac urna tempor fermentum. Curabitur rutrum arcu et lorem volutpat viverra.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2011/06/01/this-is-a-test/">This Is Post</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-06-01T14:44:00+09:00" pubdate data-updated="true">Jun 1<span>st</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Booyah!</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/5/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/09/26/alice-api/">きんモザのアリスのgif画像を取得するAPIを使ったAndroidアプリを作った</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/22/yapcasia-2013/">YAPC::ASIA 2013 感想</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/19/android-test/">モヒートはモッキングフレームワークで味はとても美味しい</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/17/interaction-design/">デザインリサーチをするにあたって</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/06/genymotion/">Genymotion速かった</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/takiguchi0817">@takiguchi0817</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'takiguchi0817',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - rejasupotaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  














</body>
</html>
