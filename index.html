
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Just posted a blog</title>
  <meta name="author" content="rejasupotaro">

  
  <meta name="description" content="ローカルのaarはjarのように参照することはできない。 1
2
3
4
dependencies { compile fileTree(dir: &#39;libs&#39;, include: &#39;*.jar&#39;) compile fileTree(dir: &#39;libs&# &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://rejasupotaro.github.io">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Just posted a blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-36257112-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Just posted a blog</a></h1>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:rejasupotaro.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/20/reference-of-local-aar/">ローカルのaarの参照を参照する</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-20T21:59:00+09:00" pubdate data-updated="true">Oct 20<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>ローカルのaarはjarのように参照することはできない。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">include:</span> <span class="err">&#39;</span><span class="o">*.</span><span class="na">jar</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'>    <span class="n">compile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span><span class="o">,</span> <span class="nl">include:</span> <span class="err">&#39;</span><span class="o">*.</span><span class="na">aar</span><span class="err">&#39;</span><span class="o">)</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>ので、リポジトリにローカルのlibsディレクトリを登録する。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mavenCentral</span><span class="o">()</span>
</span><span class='line'>    <span class="n">flatDir</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">dirs</span> <span class="err">&#39;</span><span class="n">libs</span><span class="err">&#39;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">compile</span> <span class="err">&#39;</span><span class="n">com</span><span class="o">.</span><span class="na">rejasupotaro</span><span class="o">:</span><span class="nl">mylibrary:</span><span class="mf">0.0</span><span class="o">.</span><span class="mi">1</span><span class="nd">@aar</span><span class="err">&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/17/create-intent/">Intentの生成パターン</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-17T00:02:00+09:00" pubdate data-updated="true">Oct 17<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Androidの設計思想上、Activityはどこからも呼び出されるものなので、Intentを呼び出し元で生成してExtraを付けるっていうのは、どこでgetExtraされるかとか、そもそもどんなパラメータが必要かが分かりにくくて、後から追加されたActivityでExtraが足りなくて落ちるということが起こりうると思っていました。</p>

<h2>僕のパターン</h2>

<p>そこで僕は、IntentHubというクラスを作って、画面の呼び出しなどのIntent処理をまとめてそこに書くようにしています。</p>

<h3>例.</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@InjectView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">button</span><span class="o">)</span> <span class="n">Button</span> <span class="n">mButton</span><span class="o">;</span>
</span><span class='line'><span class="nd">@Inject</span> <span class="n">IntentHub</span> <span class="n">mIntentHub</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Override</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>
</span><span class='line'>    <span class="n">mButton</span><span class="o">.</span><span class="na">setOnClickListener</span><span class="o">((</span><span class="n">view</span><span class="o">)</span> <span class="o">-&gt;</span>
</span><span class='line'>            <span class="n">mIntentHub</span><span class="o">.</span><span class="na">openCommentViewActivity</span><span class="o">(</span><span class="n">commentId</span><span class="o">);</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>GitHubのパターン</h2>

<p>他のアプリはどうしてるのかなと思ってGitHubのAndroidアプリを見てみたら、IntentsというIntentを作るためのヘルパークラスがいて、BuilderでIntentを作って、IntentFilterで対象の画面の呼び出しをしていました。つまり…コードを見た方が早いと思います。</p>

<h3>呼び出し先(CommitViewActivity)</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">static</span> <span class="n">Intent</span> <span class="nf">createIntent</span><span class="o">(</span><span class="kd">final</span> <span class="n">Repository</span> <span class="n">repository</span><span class="o">,</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">position</span><span class="o">,</span> <span class="kd">final</span> <span class="n">String</span><span class="o">...</span> <span class="n">ids</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Builder</span> <span class="n">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Builder</span><span class="o">(</span><span class="s">&quot;commits.VIEW&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">builder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">EXTRA_POSITION</span><span class="o">,</span> <span class="n">position</span><span class="o">);</span>
</span><span class='line'>    <span class="n">builder</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">EXTRA_BASES</span><span class="o">,</span> <span class="n">ids</span><span class="o">);</span>
</span><span class='line'>    <span class="n">builder</span><span class="o">.</span><span class="na">repo</span><span class="o">(</span><span class="n">repository</span><span class="o">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">builder</span><span class="o">.</span><span class="na">toIntent</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>呼び出し元Activity(NewsFragment)</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">startActivity</span><span class="o">(</span><span class="n">CommitViewActivity</span><span class="o">.</span><span class="na">createIntent</span><span class="o">(</span><span class="n">repo</span><span class="o">,</span> <span class="n">sha</span><span class="o">));</span>
</span></code></pre></td></tr></table></div></figure>


<h3>IntentFilterの定義(AndroidManifest)</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;activity</span>
</span><span class='line'>    <span class="na">android:name=</span><span class="s">&quot;.ui.commit.CommitViewActivity&quot;</span>
</span><span class='line'>    <span class="na">android:configChanges=</span><span class="s">&quot;orientation|keyboardHidden|screenSize&quot;</span> <span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;intent-filter&gt;</span>
</span><span class='line'>        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">&quot;com.github.mobile.commits.VIEW&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">&quot;android.intent.category.DEFAULT&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/intent-filter&gt;</span>
</span><span class='line'><span class="nt">&lt;/activity&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>いずれにせよ、呼び出し元のActivityで直接Intentを生成するのは良くなさそうという話でした。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/13/saving-data/">Androidのデータ保存パターン</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-13T22:36:00+09:00" pubdate data-updated="true">Oct 13<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>新しくアプリを作るときにAndroid内でのデータの持ち方や、アクセスの仕方、モデルの扱い方には色々あってどうしようってなると思うので、僕の少ない経験から考えたことをまとめます。</p>

<h1>ファイルに保存</h1>

<p>DBは注意して使わないとデータがアップデートしたら全部消えましたとか、あるカラムだけデータが入ってませんでしたとかあるので、データの簡易保存、たとえばレスポンスのjsonをそのままキャッシュするとか、検索する必要がなかったりあまり更新しないモデルをシリアライズして保存するときにはファイル保存が向いていると思います。</p>

<p>なお、JavaのSerializableは柔軟性が低く、バージョンアップでデータを壊してアプリが落ちるということが分かっていてもハンドリングできなくて防ぐのが難しかったりするので、シリアライズするときはgsonとかmessagepackを使うことをオススメします。</p>

<p>ただこのやり方でもキャッシュを管理するためのFileManager的なクラスは必要になってくると思うので、あまり複雑なことをやるのであればDBを使った方が楽になってくると思います。
独自のFileManagerクラスを作り込んでしまうと新しく入ってきた人がつらいですしね。</p>

<h1>DBに保存(素SQL)</h1>

<p>手でSQLを書くのはつらいです。人間はミスをするのでORMを使った方がいいと思います。</p>

<h1>ORM(ActiveAndroid)を利用してDBに保存</h1>

<p><a href="http://d.hatena.ne.jp/nattou_curry_2/20090102/1230903865">ActiveRecordパターン</a>のORMです。</p>

<h2>モデル定義</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Items&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="kd">extends</span> <span class="n">Model</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Name&quot;</span><span class="o">,</span> <span class="n">notNull</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">// カラム名と制約を付けることができる　</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span> <span class="c1">// ModelのFieldはpublicにしなければならない</span>
</span><span class='line'>
</span><span class='line'>  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Category&quot;</span><span class="o">)</span> <span class="c1">// リレーションが持てる</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">Category</span> <span class="n">category</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Categories&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Category</span> <span class="kd">extends</span> <span class="n">Model</span> <span class="o">{</span>
</span><span class='line'>  <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Name&quot;</span><span class="o">)</span>
</span><span class='line'>  <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Item</span><span class="o">&gt;</span> <span class="nf">items</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">getMany</span><span class="o">(</span><span class="n">Item</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">&quot;Category&quot;</span><span class="o">);</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>補足</h3>

<p>MedelのFieldに<a href="https://github.com/pardom/ActiveAndroid/blob/91bca4983a7da882b6585f124288f1aac7b299ef/src/com/activeandroid/Model.java#LC40">Idが定義</a>されていて、テーブルを作るときに<a href="https://github.com/pardom/ActiveAndroid/blob/91bca4983a7da882b6585f124288f1aac7b299ef/src/com/activeandroid/util/SQLiteUtils.java#LC161">Primary Keyになります。</a>
とはいえ内部的なIdだけでなく、サーバーからのレスポンスにIdも入っていると思うので、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Items&quot;</span><span class="o">)</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Item</span> <span class="kd">extends</span> <span class="n">Model</span> <span class="o">{</span>
</span><span class='line'>    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;ItemId&quot;</span><span class="o">)</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Name&quot;</span><span class="o">,</span> <span class="n">notNull</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">unique</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">// カラム名と制約を付けることができる　</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span> <span class="c1">// ModelのFieldはpublicにしなければならない</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Column</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&quot;Category&quot;</span><span class="o">)</span> <span class="c1">// リレーションが持てる</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">Category</span> <span class="n">category</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>このように親クラスのIdとカラム名が被らないように定義して <code>item.id</code> でアクセスするのはどうだろうかと考えています。ここでうっかり <code>item.getId()</code> とすると思っていたのと違う値が返ってくるとかあるので注意が必要です。</p>

<p>リリース後にモデルのフィールドを変更した際にはmigrationをする必要があります。詳しくはmigrationのところで書きますが、モデルの変更は注意が必要です。</p>

<h2>Query</h2>

<h3>Save</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">();</span>
</span><span class='line'><span class="n">item</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">restaurants</span><span class="o">;</span>
</span><span class='line'><span class="n">item</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">&quot;Red Robin&quot;</span><span class="o">;</span>
</span><span class='line'><span class="n">item</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Delete</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="n">Item</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">Item</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="mi">1</span><span class="o">);</span>
</span><span class='line'><span class="n">item</span><span class="o">.</span><span class="na">delete</span><span class="o">();</span>
</span><span class='line'><span class="c1">// or</span>
</span><span class='line'><span class="k">new</span> <span class="nf">Delete</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Item</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;Id = ?&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Bulk insert</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ActiveAndroid</span><span class="o">.</span><span class="na">beginTransaction</span><span class="o">();</span>
</span><span class='line'><span class="k">try</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">Item</span> <span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Item</span><span class="o">();</span>
</span><span class='line'>            <span class="n">item</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="s">&quot;Example &quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">;</span>
</span><span class='line'>            <span class="n">item</span><span class="o">.</span><span class="na">save</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="n">ActiveAndroid</span><span class="o">.</span><span class="na">setTransactionSuccessful</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="k">finally</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">ActiveAndroid</span><span class="o">.</span><span class="na">endTransaction</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>トランザクションでラップすると40msで、使わないと4secかかるとのことです。</p>

<h3>補足</h3>

<p><a href="https://github.com/pardom/ActiveAndroid/blob/91bca4983a7da882b6585f124288f1aac7b299ef/src/com/activeandroid/query/From.java#LC54">join、leftJoin、outerJoin、innerJoin、crossJoinもできます。</a></p>

<h2>Migration</h2>

<p><code>/assets/migraions/2.sql</code> のようにsqlを置いておくとonUpgradeで実行されます。
カラムを追加するだけなら以下の書けます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sql'><span class='line'><span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Items</span> <span class="k">ADD</span> <span class="k">COLUMN</span> <span class="n">price</span> <span class="nb">INTEGER</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>migrationはバージョンアップ後にユーザーの手元で<a href="https://github.com/pardom/ActiveAndroid/blob/791652b3fbf130448a5b152d12764a451e421b47/src/com/activeandroid/DatabaseHelper.java#LC137">順番に実行される</a>ので、アプリをインストールしてからしばらく期間をおいてからそのユーザーがアプリのバージョンアップをしたとすると、空いた期間分のマイグレーションが走って初回起動にやや時間がかかるかと思います。(そこまで大きな影響があるとは思いませんが)
起動時間より、migrationファイルを作り忘れたとかそっちの方がこわいので、モデルを変更するとき・レビューするときには気をつけて見たほうがよさそうです。</p>

<h2>その他ORMとの比較</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// GreenDAO</span>
</span><span class='line'><span class="n">List</span><span class="o">&lt;</span><span class="n">Todo</span><span class="o">&gt;</span> <span class="n">ended</span> <span class="o">=</span> <span class="n">daoSession</span><span class="o">.</span><span class="na">getTodoDao</span><span class="o">().</span><span class="na">queryBuilder</span><span class="o">()</span>
</span><span class='line'>        <span class="o">.</span><span class="na">where</span><span class="o">(</span><span class="k">new</span> <span class="n">StringCondition</span><span class="o">(</span>
</span><span class='line'>            <span class="n">TodoDao</span><span class="o">.</span><span class="na">Properties</span><span class="o">.</span><span class="na">Status</span><span class="o">.</span><span class="na">columnName</span> <span class="o">+</span> <span class="s">&quot;=?&quot;</span><span class="o">,</span>
</span><span class='line'>            <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">TodoDaoHelper</span><span class="o">.</span><span class="na">STATUS_END</span><span class="o">))).</span><span class="na">list</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// ActiveAndroid</span>
</span><span class='line'><span class="k">new</span> <span class="nf">Select</span><span class="o">().</span><span class="na">from</span><span class="o">(</span><span class="n">Todo</span><span class="o">.</span><span class="na">class</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="s">&quot;Status=?&quot;</span><span class="o">,</span> <span class="n">STATUS_END</span><span class="o">).</span><span class="na">execute</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>greenDAOも見てみたのですが、daoSessionを引き回さないといけないのと、全体的に冗長だなという印象です。その分DAOの方がバグが入りにくそうなので、用途によって選択すればいいと思います。</p>

<p>See also:</p>

<ul>
<li><a href="http://stackoverflow.com/questions/13680954/green-dao-vs-orm-lite-vs-active-android">Green DAO vs ORM lite vs Active Android</a></li>
<li><a href="http://software-workshop.eu/content/comparing-android-orm-libraries-greendao-vs-ormlite">Comparing android ORM libraries - GreenDAO vs Ormlite</a></li>
</ul>


<h1>まとめ</h1>

<p>キャッシュはファイルに保存して、モデルは要件に応じてORMを使ってDBに保存するのがいいと思います。
もしActiveAndroidを使うならAPIレスポンスをgsonとかで直接モデルに変換するとカオスになるのでentityを作るのがいいです、みたいにデータ保存はアプリの全体設計に関わってくるので、もし新しくアプリを作る場合はなるべく早い段階から検討をするといいと思います。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/07/native-ui/">Narive UI</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-07T23:55:00+09:00" pubdate data-updated="true">Oct 7<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>人は何を見てアプリっぽいと感じるのだろうか。</p>

<div>
<img src="http://gifzo.net/jTEl4YmZqD.gif" style="float:left">
<img src="http://gifzo.net/BHFQmyIfFHF.gif" style="float:left">
</div>




<div style="clear:both">
<img src="http://gifzo.net/BWvNCrQFYfF.gif" style="float:left">
<img src="http://gifzo.net/BGth4C1Ok64.gif" style="float:left">
</div>




<div style="clear:both">
<img src="http://gifzo.net/lSwyh4fg6P.gif" style="float:left">
<img src="http://gifzo.net/68NrYQW2tB.gif" style="float:left">
</div>




<div style="clear:both">
<img src="http://gifzo.net/OKyqq1D9yD.gif" style="float:left">
<img src="http://gifzo.net/mtHN4UIAMZ.gif" style="float:left">
</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/10/06/feed-ui-patterns/">Feed UI Patterns</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-10-06T17:50:00+09:00" pubdate data-updated="true">Oct 6<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>タイムラインとかフィードを見る系でいい感じのアプリない？と聞かれたのでアプリのUIを眺めていました。</p>

<h3>Feedly</h3>

<p><img src="https://dl.dropboxusercontent.com/u/54255753/blog/201310/feedly.png" width="300px"></p>

<h3>foursquare</h3>

<p><img src="http://img1.mobile-patterns.com/img/full/1363118152348-2013-03-03%2020.23.25.png" width="300px"></p>

<h3>YouTube</h3>

<p><img src="http://img3.mobile-patterns.com/img/full/1363118191519-2013-03-03%2022.46.46.png" width="300px"></p>

<h3>SocialCam</h3>

<p><img src="http://25.media.tumblr.com/tumblr_lyr31slYLr1r750h1o1_500.png" width="300px"></p>

<h3>Path</h3>

<p><img src="http://31.media.tumblr.com/tumblr_lvifhic1MU1r750h1o1_500.jpg" width="300px"></p>

<h3>Pinterest</h3>

<p><img src="https://dl.dropboxusercontent.com/u/54255753/blog/201310/pinterest.png" width="300px"></p>

<h3>Gunosy</h3>

<p><img src="https://dl.dropboxusercontent.com/u/54255753/blog/201310/gunosy.png" width="300px"></p>

<p>見比べてみて、誰が投稿したか、誰が投稿に対して反応したか、何時に投稿されたか、何を最初に知らせたいのか、写真を良く見せたい、などそのサービスにとって何が重要なのかによって &#8220;いい感じ&#8221; の意味が変わってくるなあと思いました。</p>

<p>ちなみに僕はデザインの引き出しが少ないので、まとめサイト的なものを見て探しています。</p>

<ul>
<li><a href="http://www.mobile-patterns.com/">Mobile UI Patterns</a></li>
<li><a href="http://www.mobiledesignpatterngallery.com/mobile-patterns.php">Mobile Design Pattern Gallery</a></li>
<li><a href="">Android Interaction Design Patterns</a></li>
<li><a href="http://www.androidviews.net/">AndroidViews</a></li>
<li><a href="http://www.androiduipatterns.com/">Android // UI Patterns</a></li>
<li><a href="http://www.lovelyui.com/">lovely ui</a></li>
<li><a href="http://androidpttrns.com/">android pttrns</a></li>
<li><a href="http://androidniceties.tumblr.com/">Android Niceties</a></li>
<li><a href="http://www.uxarchive.com/">UX Archive</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/30/upload-to-s3/">S3でmavenリポジトリをホストしてGradleでアップロードする</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-30T22:52:00+09:00" pubdate data-updated="true">Sep 30<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>bucket, key, secretは外部ファイルに定義しておきます。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">configurations</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">deployerJars</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mavenCentral</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">deployerJars</span> <span class="s1">&#39;org.springframework.build.aws:org.springframework.build.aws.maven:3.0.0.RELEASE&#39;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">uploadArchives</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mavenDeployer</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">configuration</span> <span class="o">=</span> <span class="n">configurations</span><span class="o">.</span><span class="na">deployerJars</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">repository</span><span class="o">(</span><span class="nl">url:</span> <span class="s2">&quot;s3://${project.s3Bucket}/release&quot;</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                <span class="n">authentication</span><span class="o">(</span><span class="nl">userName:</span> <span class="n">project</span><span class="o">.</span><span class="na">s3Key</span><span class="o">,</span> <span class="nl">passphrase:</span> <span class="n">project</span><span class="o">.</span><span class="na">s3Secret</span><span class="o">)</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">pom</span><span class="o">.</span><span class="na">groupId</span> <span class="o">=</span> <span class="s1">&#39;com.rejasupotaro&#39;</span>
</span><span class='line'>            <span class="n">pom</span><span class="o">.</span><span class="na">artifactId</span> <span class="o">=</span> <span class="s1">&#39;mylibrary&#39;</span>
</span><span class='line'>            <span class="n">pom</span><span class="o">.</span><span class="na">version</span> <span class="o">=</span> <span class="s1">&#39;1.0.0&#39;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>これで gradle uploadArchives すればアップロードすることができます。</p>

<p>ライブラリを使う側は以下のようにします。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">maven</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">url</span> <span class="s2">&quot;https://${project.s3Bucket}.s3.amazonaws.com/release&quot;</span>
</span><span class='line'>        <span class="n">credentials</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">username</span> <span class="n">project</span><span class="o">.</span><span class="na">s3Key</span>
</span><span class='line'>            <span class="n">password</span> <span class="n">project</span><span class="o">.</span><span class="na">s3Secret</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">compile</span> <span class="s1">&#39;com.rejasupotaro:mylibrary:1.0.0&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/28/android-books/">Android開発を始めたばかりの僕が読みたかった本</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-28T00:42:00+09:00" pubdate data-updated="true">Sep 28<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img src="https://dl.dropboxusercontent.com/u/54255753/blog/201309/reading.png" alt="" /></p>

<p>最近、スマートフォンアプリ開発をやる人増えてきてオススメの本ある？って聞かれること多くなってきたのですが、その人のバックグラウンドによるところも大きいと思うので、自分がAndroidアプリ開発を始めたときに読んでて役に立った、あるいは読んでおきたかったという目線で、良かった本をいくつか挙げようと思います。</p>

<h2>Effective Java</h2>

<p>Java界隈では多くの人が読んでいると思いますが、AndroidからJavaに入った人だと読んだことがない人もいると思います。
Javaを書く上でのエッセンスが詰め込まれているので、まだ読んでいない方は読むことをおすすめします。</p>

<h2>JUnit実践入門</h2>

<p>Androidだとテストが書かれないことが多いです。しかし、書いた方がデバッグの時間が短くなる上に保守もしやすくなりますし、テストを書きやすい構造を意識するようになって、上達が早くなりますし、設計も綺麗になります。(と思います)
僕も最初はテストを書かなかったのですが、もっと早くからテストを書いていればなと思っています。</p>

<h2>現場で使える[逆引き+実践]Androidプログラミングテクニック</h2>

<p>逆引き系の本なのですが、それだけでなく <strong>SQLiteの処理を高速化したい</strong> であったり、<strong>OutMemoryErrorをなんとか回避したいとか</strong> や、<strong>複数のアクティビティで共通の処理を、Template Methodパターンで実装したい/移譲で実装したい/Strategyパターンで実装したい</strong> など、デザインパターンや実践的なノウハウが詰まっている良い本でした。</p>

<h2>SMASHING Android UI</h2>

<p><a href="http://www.androiduipatterns.com/">Android // UI PATTERNS</a> というブログで有名なJuhani Lehtimakiさんの本です。最近翻訳されて日本で発売されました。
この本も、ただUIのコンポーネントの説明に終わるだけでなく、デザインとどう向き合うかや、ユーザーテストのやり方や、Androidプラットフォームの課題など、スマートフォンエンジニアにとって重要なデザインのことが学べる数少ない良書だと思います。</p>

<hr />

<p>ここから先はAndroidのさらに高度なプログラムを書きたい人向けです。</p>

<h2>Java言語で学ぶデザインパターン入門【マルチスレッド編】</h2>

<p>通信などの非同期処理、並列処理を書くときに、パフォーマンスの悪いプログラムを書いてしまったり、最悪デッドロックを起こしてしまったりしてしまわないために、特にこれからライブラリを書く人はこの本を読んだ方がいいです。
またライブラリを書かない人でもこの本を読んでおくと「ああ、あのパターンで実装されているのか！」みたいに、理解の助けになったりします。</p>

<h2>サクサク動く！Androidアプリ高速化プログラミング</h2>

<p>アプリの規模が大きくなってきてパフォーマンスに問題を感じるようになったり、局所的にプログラムを速くしたいというときにはこの本がおすすめです。デバッグ手法やレイアウトの最適化の話から、アセンブラやメモリアクセスやGCの話もあるので、読み物としても面白かったです。</p>

<hr />

<p>その他、本以外に参考にしているもの</p>

<h2><a href="https://twitter.com/androidniceties">@androidniceties</a></h2>

<p>Android Nicetiesのtumblrの更新をツイートしてくれます。
デザインを専門に学んでいなかった僕は、とにかく多くのパターンに触れなければと思っています。デザインは0から生まれるものではなく、過去の事例であったり、自然界に存在する美しいものの模倣から生まれるみたいな話がありますし、なにより実績のあるアプリのデザインは僕が考えだしたUIより質が高いです。</p>

<h2><a href="http://www.androidviews.net/">ANDROIDVIEWS</a></h2>

<p>あのアプリの実装オシャレだなとか思ったら、ここに載っていたりします。
自分で実装するときの助けになったりとか、ライブラリを使うことで簡単に実装できたりします。見てるだけでも楽しいです。</p>

<h2><a href="https://github.com/square">Square</a></h2>

<p>決済サービスのあのスクエアのGitHubアカウントです。dagger、otto、picasso、fest-androidなど、これらの有名なライブラリも実はこのスクエア製で、インタフェースの素晴らしさも去ることながら、プログラムがとても綺麗で、ある意味書籍よりも勉強になると思います。</p>

<hr />

<h2>まとめ</h2>

<p>こんなに一度に紹介されても読むのはたいへん…ですが、まずは調べてみて興味を持ったところから読んでみるといいと思います。
スマートフォンエンジニアはデザインから低レイヤまで幅広い知識を要求されます(といってもエンジニアリングってどの分野もそうなのですが)が、まずは自分の好きを伸ばして、それからもっと良いアプリを作るために、足りないところを補っていくというやり方がいいのかなと思いました。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/26/alice-api/">きんモザのアリスのgif画像を取得するAPIを使ったAndroidアプリを作った</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-26T01:09:00+09:00" pubdate data-updated="true">Sep 26<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="https://github.com/takiguchi0817/KinMoza/tree/master">
<img src="https://dl.dropboxusercontent.com/u/54255753/blog/201309/alice_github.png">
</a></p>

<p>See also</p>

<ul>
<li><a href="http://mogashi.hateblo.jp/entry/2013/09/24/000619">きんモザのアリスのgif画像を取得するAPIを作った</a></li>
<li><a href="http://pastak.hatenablog.com/entry/2013/09/25/004437">きんモザのアリスのgif画像を取得するAPIを利用したGoogle Chrome拡張を作った</a></li>
<li><a href="http://moroya.hatenablog.jp/entry/2013/09/25/224446">きんモザのアリスAPIを使って、好きなアリスを無限ループ視聴出来るWebアプリを作った</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/22/yapcasia-2013/">YAPC::ASIA 2013 感想</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-22T11:14:00+09:00" pubdate data-updated="true">Sep 22<span>nd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>感想を書こうと思ったけどスライドを並べたらかなり長くなってしまったので別のところで書きます。</p>

<h1>まとめ</h1>

<ul>
<li><a href="http://gihyo.jp/news/report/01/yapcasia2013/0000">YAPC::Asia Tokyo 2013 前夜祭レポート</a></li>
<li><a href="http://gihyo.jp/news/report/01/yapcasia2013/0001">YAPC::Asia Tokyo 2013 1日目レポート</a></li>
<li><a href="http://gihyo.jp/news/report/01/yapcasia2013/0002">YAPC::Asia Tokyo 2013 2日目レポート</a></li>
</ul>


<h1>一日目</h1>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26368940" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/kazeburo/yapc2013psgi-plack" title="How to build a High Performance PSGI/Plack Server " target="_blank">How to build a High Performance PSGI/Plack Server </a> </strong> from <strong><a href="http://www.slideshare.net/kazeburo" target="_blank">Masahiro Nagano</a></strong> </div></p>

<p><a href="http://songmu.github.io/slides/yapc-asia2013/">今時のカジュアルなデータベース関連開発</a></p>

<div style="width: 60%">
<script async class="speakerdeck-embed" data-id="552f7d1003e60131954556f7ac4f018a" data-ratio="1.2994923857868" src="//speakerdeck.com/assets/embed.js"></script>
</div>




<iframe src="http://www.slideshare.net/slideshow/embed_code/26371335" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/DaisukeTamada/perl-26371335" title="大規模Perl初心者研修を支える技術" target="_blank">大規模Perl初心者研修を支える技術</a> </strong> from <strong><a href="http://www.slideshare.net/DaisukeTamada" target="_blank">Daisuke Tamada</a></strong> </div></p>

<p><a href="http://kazuph.github.io/presentation/yapc_vim_2013_github/#/">Vim実践入門 Perl編</a></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26371230" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/egopro/yapc2013talk" title="「アレ」と Perl で AWS を - YAPC::Asia Tokyo 2013" target="_blank">「アレ」と Perl で AWS を - YAPC::Asia Tokyo 2013</a> </strong> from <strong><a href="http://www.slideshare.net/egopro" target="_blank">Eikichi Gotoh</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26371154" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/xtetsuji/apachemodperl-yapcasia" title="Apacheの展望とmod_perlの超絶技巧 #yapcasia" target="_blank">Apacheの展望とmod_perlの超絶技巧 #yapcasia</a> </strong> from <strong><a href="http://www.slideshare.net/xtetsuji" target="_blank">Tetsuji Ogata</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26371482" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/TasukuSuenaga/yapc2013" title="0から学んだポストモダンPerl @ YAPC::Asia Tokyo 2013" target="_blank">0から学んだポストモダンPerl @ YAPC::Asia Tokyo 2013</a> </strong> from <strong><a href="http://www.slideshare.net/TasukuSuenaga" target="_blank">Tasuku Suenaga</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26398925" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/hiratara/types-andperl-language" title="Types and perl language" target="_blank">Types and perl language</a> </strong> from <strong><a href="http://www.slideshare.net/hiratara" target="_blank">Masahiro Honma</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26371522" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/moznion/yapc2013-26371522" title="YAPC::Asia 2013 - CPAN Testers Reports の情報を上手に使う" target="_blank">YAPC::Asia 2013 - CPAN Testers Reports の情報を上手に使う</a> </strong> from <strong><a href="http://www.slideshare.net/moznion" target="_blank">moznion</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26386299" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/DQNEO/git-yapcasia2013" title="やさしいGitの内部構造 - yapcasia2013" target="_blank">やさしいGitの内部構造 - yapcasia2013</a> </strong> from <strong><a href="http://www.slideshare.net/DQNEO" target="_blank">DQNEO</a></strong> </div></p>

<div style="width: 60%">
<script async class="speakerdeck-embed" data-id="192c25d003f30131e2af62034c419aee" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>




<div style="width: 60%">
<script async class="speakerdeck-embed" data-id="fe0568a0047501310e2442095ef5c3d5" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
</div>




<div style="width: 60%">
<script async class="speakerdeck-embed" data-id="512b43d0044201319a7e5a401ba27687" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>


<h1>二日目</h1>

<div style="width: 60%">
<script async class="speakerdeck-embed" data-id="51b4379004a301319a7f5a401ba27687" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script>
</div>


<h2><a href="http://dl.dropboxusercontent.com/u/224433/YAPC2013/index.html">社内ISUCONのつくりかた</a></h2>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26401694" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/horiyasu/programming-aws-with-perl-at" title="Programming AWS with Perl at YAPC::Asia 2013" target="_blank">Programming AWS with Perl at YAPC::Asia 2013</a> </strong> from <strong><a href="http://www.slideshare.net/horiyasu" target="_blank">Yasuhiro Horiuchi</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26403213" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/goccy/yapc2013-26403213" title="これからのPerlプロダクトのかたち(YAPC::Asia 2013)" target="_blank">これからのPerlプロダクトのかたち(YAPC::Asia 2013)</a> </strong> from <strong><a href="http://www.slideshare.net/goccy" target="_blank">goccy</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26401998" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/hidek/perl-26401998" title="Perl で作るメディアストリーミングサーバー" target="_blank">Perl で作るメディアストリーミングサーバー</a> </strong> from <strong><a href="http://www.slideshare.net/hidek" target="_blank">Hideo Kimura</a></strong> </div></p>

<iframe src="http://www.slideshare.net/slideshow/embed_code/26399483" width="427" height="356" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC;border-width:1px 1px 0;margin-bottom:5px" allowfullscreen webkitallowfullscreen mozallowfullscreen> </iframe>


<p> <div style="margin-bottom:5px"> <strong> <a href="https://www.slideshare.net/mishikawa55/2013-yapc" title="フロントエンド制作向けビルド ツールGruntがバックエンド 開発でも意外と使える！ @M_Ishikawa #yapcasia" target="_blank">フロントエンド制作向けビルド ツールGruntがバックエンド 開発でも意外と使える！ @M_Ishikawa #yapcasia</a> </strong> from <strong><a href="http://www.slideshare.net/mishikawa55" target="_blank">Masayuki Ishikawa</a></strong> </div></p>

<h2>YAPC::Asia Tokyo 2013 特別座談会 「Rubyの良いところ語ってください 〜そんなPerlで大丈夫か？〜」</h2>

<blockquote class="twitter-tweet"><p>Perlのカンファレンスの様子です <a href="http://t.co/okpblHNgLO">pic.twitter.com/okpblHNgLO</a></p>&mdash; レジャスポ太郎 (@rejasupotaro) <a href="https://twitter.com/rejasupotaro/statuses/381277626326728704">September 21, 2013</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<div style="width: 60%">
<script async class="speakerdeck-embed" data-id="b1ccfdd004eb0131dc105aad22485907" data-ratio="1.2896725440806" src="//speakerdeck.com/assets/embed.js"></script>
</div>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2013/09/19/android-test/">モヒートはモッキングフレームワークで味はとても美味しい</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-19T22:40:00+09:00" pubdate data-updated="true">Sep 19<span>th</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h1>mojito (モヒート)</h1>

<p><img src="http://dl.dropbox.com/u/54255753/blog/201301/mojito.jpg" alt="" /></p>

<p>モヒートは、キューバ・ハバナ発祥のカクテルの一つ。<br/>
由来は、新大陸として注目されていたアメリカ諸国から得られる富をコントロールする名目で、英国女王エリザベス1世が、スペイン領の都市を略奪する海賊達の手助けをしていた16世紀後半、海賊フランシス・ドレイクの部下であるリチャード・ドレイクが、1586年にモヒートの前身となる飲み物「ドラケ(draque)」をキューバの人々へ伝えた、という説が有力。<br/>
ラムをベースにソーダ、ライム、砂糖、ミントを加えたもの。ミントとソーダの清涼感が暑い夏にぴったりな「夏と言えば」の定番カクテル。</p>

<p>アーネスト・ヘミングウェイが好んで飲んでいた話は有名である。</p>

<h1><a href="http://code.google.com/p/mockito/">mockito</a> (モヒート)</h1>

<p><img src="http://dl.dropbox.com/u/54255753/blog/201301/mockito.jpg" alt="" /></p>

<p>モヒートは、Javaのモックライブラリ。<br/>
モックライブラリは他にもいろいろあるけど <a href="http://code.google.com/p/mockito/wiki/MockitoVSEasyMock">EasyMockと比べても</a> mockitoの方が簡潔に書ける。<br/>
導入するとモヒートを飲んだあとのようにスカッとする。</p>

<p><strong>&#8220;Mockito is a mocking framework that tastes really good!&#8221;</strong> とのこと。(公式)</p>

<h1>mockitoナシ</h1>

<p>今までのやり方。まずモッククラスを定義して、</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">com.android.volley.Network</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.android.volley.NetworkResponse</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.android.volley.Request</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">com.android.volley.VolleyError</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MockNetwork</span> <span class="kd">implements</span> <span class="n">Network</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kt">byte</span><span class="o">[]</span> <span class="n">mFakeResponseData</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFakeResponseData</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">mFakeResponseData</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="n">NetworkResponse</span> <span class="nf">performRequest</span><span class="o">(</span><span class="n">Request</span><span class="o">&lt;?&gt;</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">VolleyError</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">NetworkResponse</span><span class="o">(</span><span class="n">mFakeResponseData</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>テストするときに返したいデータをセットする。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">MockNetwork</span> <span class="n">mockNetwork</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MockNetwork</span><span class="o">();</span>
</span><span class='line'><span class="n">mockNetwork</span><span class="o">.</span><span class="na">setFakeResponseData</span><span class="o">(</span><span class="s">&quot;{\&quot;code\&quot;:200}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<h1>mockitoアリ</h1>

<p>このメソッドが呼ばれたときにこれを返す、とするだけ。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Network</span> <span class="n">mockNetwork</span> <span class="o">=</span> <span class="n">mock</span><span class="o">(</span><span class="n">Network</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span><span class='line'><span class="n">when</span><span class="o">(</span><span class="n">mockNetwork</span><span class="o">.</span><span class="na">performRequest</span><span class="o">(</span><span class="n">any</span><span class="o">(</span><span class="n">Request</span><span class="o">.</span><span class="na">class</span><span class="o">))).</span>
</span><span class='line'>        <span class="n">thenReturn</span><span class="o">(</span><span class="k">new</span> <span class="n">NetworkResponse</span><span class="o">(</span><span class="s">&quot;{\&quot;code\&quot;:200}&quot;</span><span class="o">.</span><span class="na">getBytes</span><span class="o">()));</span>
</span></code></pre></td></tr></table></div></figure>


<p>インタフェースが統一されることによって、次にテストを書く人が「MockNetworkというクラスがあるらしい、ふむふむ、setFakeResponseDataに渡したbyte列がperformRequestで返ってくるのか」と調べる時間を省くことができる。</p>

<p>特定のオブジェクトの一部のメソッドの振る舞いを変えるときもカンタン。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">doReturn</span><span class="o">(</span><span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span> <span class="o">{</span> <span class="n">put</span><span class="o">(</span><span class="s2">&quot;fake&quot;</span><span class="o">,</span> <span class="s2">&quot;foo&quot;</span><span class="o">);</span> <span class="o">}</span> <span class="o">}).</span><span class="na">when</span><span class="o">(</span><span class="n">spyRequest</span><span class="o">).</span><span class="na">getHeaders</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>ちなみにdependencyを解決できなかったので、jarを落として ./src/instrumentTest/libs/ に配置して以下のようにした。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">instrumentTestCompile</span> <span class="nf">fileTree</span><span class="o">(</span><span class="nl">dir:</span> <span class="s1">&#39;./src/instrumentTest/libs&#39;</span><span class="o">,</span> <span class="nl">include:</span> <span class="s1">&#39;*.jar&#39;</span><span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>モヒートにギョームでもプライベートでもお世話になってる。</p>

<hr />

<p>↑ここまでモヒートの話↑<br/>
↓ここまで他のフレームワークの紹介↓</p>

<h1><a href="http://square.github.io/fest-android/">Fest Android</a></h1>

<p>安心と信頼の <a href="https://github.com/square">Square</a> 製テストフレームワーク。(Squareが公開してるライブラリは本当にどれもレベルが高い)<br/>
元ネタは <a href="http://fest.easytesting.org/">Fixtures for Easy Software Testing</a> のAndroid拡張となっている。</p>

<h3>REGULAR JUNIT</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">assertEquals</span><span class="o">(</span><span class="n">View</span><span class="o">.</span><span class="na">VISIBLE</span><span class="o">,</span> <span class="n">layout</span><span class="o">.</span><span class="na">getVisibility</span><span class="o">());</span>
</span><span class='line'><span class="n">assertEquals</span><span class="o">(</span><span class="n">VERTICAL</span><span class="o">,</span> <span class="n">layout</span><span class="o">.</span><span class="na">getOrientation</span><span class="o">());</span>
</span><span class='line'><span class="n">assertEquals</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="n">layout</span><span class="o">.</span><span class="na">getChildCount</span><span class="o">());</span>
</span><span class='line'><span class="n">assertEquals</span><span class="o">(</span><span class="n">SHOW_DIVIDERS_MIDDLE</span><span class="o">,</span> <span class="n">layout</span><span class="o">.</span><span class="na">getShowDividers</span><span class="o">());</span>
</span></code></pre></td></tr></table></div></figure>


<h3>FEST ANDROID</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">assertThat</span><span class="o">(</span><span class="n">layout</span><span class="o">).</span><span class="na">isVisible</span><span class="o">()</span>
</span><span class='line'>    <span class="o">.</span><span class="na">isVertical</span><span class="o">()</span>
</span><span class='line'>    <span class="o">.</span><span class="na">hasChildCount</span><span class="o">(</span><span class="mi">4</span><span class="o">)</span>
</span><span class='line'>    <span class="o">.</span><span class="na">hasShowDividers</span><span class="o">(</span><span class="n">SHOW_DIVIDERS_MIDDLE</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<h1><a href="https://github.com/mttkay/calculon">calculon</a></h1>

<p><img src="https://raw.github.com/mttkay/calculon/master/assets/calculon.png" alt="" /></p>

<p>こちらも便利メソッドを提供している。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="c1">// direct assertion on current activity</span>
</span><span class='line'><span class="n">assertThat</span><span class="o">().</span><span class="na">inPortraitMode</span><span class="o">();</span>
</span><span class='line'><span class="n">assertThat</span><span class="o">().</span><span class="na">viewExists</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">launch_bar_button</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// assert specific condition on current activity</span>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">().</span><span class="na">satisfies</span><span class="o">(</span><span class="k">new</span> <span class="n">Predicate</span><span class="o">&lt;</span><span class="n">Activity</span><span class="o">&gt;()</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">check</span><span class="o">(</span><span class="n">Activity</span> <span class="n">target</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">target</span><span class="o">.</span><span class="na">isTaskRoot</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">});</span>
</span></code></pre></td></tr></table></div></figure>


<p>Fest Androidとの違いは、calculonはStoryTestを提供しており、画面遷移を伴うストーリーをテストとして実行することができる。</p>

<h1>Robolectric + Spock</h1>

<p>この動画で紹介されているGroovyの元祖PowerAssert系テストフレームワーク <a href="https://code.google.com/p/spock/">Spock</a> を頑張ってAndroidで動かすというもの。</p>

<iframe width="420" height="315" src="//www.youtube.com/embed/aDoQxqO_6rI" frameborder="0" allowfullscreen></iframe>


<p>RobolectricはAndroidのテストをJVM上で実行するためのフレームワークで、AndroidのクラスをJavaのShadowクラスに変換して実行するしくみになっている。
JVMでテストが実行できるようになるということは、Groovyでもテストが書けるということなので、Robolectricを導入すればSpockも使えるようになる。</p>

<h3>Robolectric</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">testDialogContent</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// given</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">MainActivity</span> <span class="n">mainActivity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MainActivity</span><span class="o">();</span>
</span><span class='line'>    <span class="n">mainActivity</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// when</span>
</span><span class='line'>    <span class="n">mainActivity</span><span class="o">.</span><span class="na">button</span><span class="o">.</span><span class="na">performClick</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// then</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">ShadowAlertDialog</span> <span class="n">dialog</span> <span class="o">=</span> <span class="o">(</span><span class="n">ShadowAlertDialog</span><span class="o">)</span> <span class="n">Robolectric</span><span class="o">.</span><span class="na">shadowOf</span><span class="o">(</span><span class="n">ShadowDialog</span><span class="o">.</span><span class="na">getLatestDialog</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;title&quot;</span><span class="o">,</span> <span class="n">dialog</span><span class="o">.</span><span class="na">getTitle</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;Ok&quot;</span><span class="o">,</span> <span class="n">dialog</span><span class="o">.</span><span class="na">getButton</span><span class="o">(</span><span class="n">AlertDialog</span><span class="o">.</span><span class="na">BUTTON_POSITIVE</span><span class="o">).</span><span class="na">getText</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;Cancel&quot;</span><span class="o">,</span> <span class="n">dialog</span><span class="o">.</span><span class="na">getButton</span><span class="o">(</span><span class="n">AlertDialog</span><span class="o">.</span><span class="na">BUTTON_NEGATIVE</span><span class="o">).</span><span class="na">getText</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;Dismiss&quot;</span><span class="o">,</span> <span class="n">dialog</span><span class="o">.</span><span class="na">getButton</span><span class="o">(</span><span class="n">AlertDialog</span><span class="o">.</span><span class="na">BUTTON_NEUTRAL</span><span class="o">).</span><span class="na">getText</span><span class="o">());</span>
</span><span class='line'>    <span class="n">Assert</span><span class="o">.</span><span class="na">assertEquals</span><span class="o">(</span><span class="s">&quot;Dialog Content&quot;</span><span class="o">,</span> <span class="n">dialog</span><span class="o">.</span><span class="na">getMessage</span><span class="o">());</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<h3>Robolectric + Spock</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="kt">def</span> <span class="s2">&quot;should displayed dialog&#39;s button has good text&quot;</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="nl">given:</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">mainActivity</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MainActivity</span><span class="o">()</span>
</span><span class='line'>    <span class="n">mainActivity</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="kc">null</span><span class="o">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="nl">when:</span>
</span><span class='line'>    <span class="n">mainActivity</span><span class="o">.</span><span class="na">button</span><span class="o">.</span><span class="na">performClick</span><span class="o">()</span>
</span><span class='line'>    <span class="kt">def</span> <span class="n">dialog</span> <span class="o">=</span> <span class="o">(</span><span class="n">ShadowAlertDialog</span><span class="o">)</span> <span class="n">Robolectric</span><span class="o">.</span><span class="na">shadowOf</span><span class="o">(</span><span class="n">ShadowDialog</span><span class="o">.</span><span class="na">getLatestDialog</span><span class="o">());</span>
</span><span class='line'>
</span><span class='line'>    <span class="nl">then:</span>
</span><span class='line'>    <span class="n">dialog</span><span class="o">.</span><span class="na">getButton</span><span class="o">(</span><span class="n">number</span><span class="o">).</span><span class="na">text</span> <span class="o">==</span> <span class="n">value</span>
</span><span class='line'>
</span><span class='line'>    <span class="nl">where:</span>
</span><span class='line'>    <span class="n">number</span>                      <span class="o">|</span> <span class="n">value</span>
</span><span class='line'>    <span class="n">AlertDialog</span><span class="o">.</span><span class="na">BUTTON_POSITIVE</span> <span class="o">|</span> <span class="s2">&quot;Ok&quot;</span>
</span><span class='line'>    <span class="n">AlertDialog</span><span class="o">.</span><span class="na">BUTTON_NEGATIVE</span> <span class="o">|</span> <span class="s2">&quot;Cancel&quot;</span>
</span><span class='line'>    <span class="n">AlertDialog</span><span class="o">.</span><span class="na">BUTTON_NEUTRAL</span>  <span class="o">|</span> <span class="s2">&quot;Dismiss&quot;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>導入コスト、学習コスト、効果を鑑みつつ、引き続きテスティングフレームワークをテイスティングしていきます。</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/2/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2013/10/20/reference-of-local-aar/">ローカルのaarの参照を参照する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/17/create-intent/">Intentの生成パターン</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/13/saving-data/">Androidのデータ保存パターン</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/07/native-ui/">Narive UI</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/10/06/feed-ui-patterns/">Feed UI Patterns</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/rejasupotaro">@rejasupotaro</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'rejasupotaro',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2013 - rejasupotaro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  














</body>
</html>
